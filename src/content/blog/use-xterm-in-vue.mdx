---
publishDate: 2024-07-20
title: Xterm åœ¨ Vue ä¸­çš„åº”ç”¨
excerpt: åœ¨ Vue ä¸­ä½¿ç”¨ Xtermï¼Œå¹¶é€‚é…å±å¹•å°ºå¯¸å˜åŒ–
image: '~/assets/images/blog/michael-myers-XzAUWNPCp1A-unsplash.jpg'
category: client
tags:
  - xterm
  - vue
metadata:
  image_author:
    link: https://unsplash.com/@myers2021
    name: myers2021
---

## Xterm ç®€ä»‹

Xterm æ˜¯ä¸€ä¸ªæµè§ˆå™¨ç»ˆç«¯å·¥å…·ï¼Œå¾ˆå¤šä½ è§åˆ°çš„å¼€æºé¡¹ç›®ä¸­éƒ½æœ‰ä½¿ç”¨å®ƒï¼Œæ¯”å¦‚ä¸€äº›ç®¡ç†é¢æ¿ï¼Œæ¯”å¦‚ 1panelç­‰ã€‚å®ƒçš„å®˜ç½‘æ˜¯ [https://xtermjs.org](https://xtermjs.org)ã€‚

## ä½¿ç”¨æ–¹å¼

#### 1. åˆ›å»ºä¸»æ–‡ä»¶ï¼Œ`main.js`

```javascript
import { Terminal } from '@xterm/xterm';
import { WebglAddon } from '@xterm/addon-webgl';
import { FitAddon } from '@xterm/addon-fit';
import { WebLinksAddon } from '@xterm/addon-web-links';
import { baseTheme } from './theme';
import { customData } from './data';

export const fitAddon = new FitAddon();

export const term = new Terminal({
  fontFamily: '"Cascadia Code", Menlo, monospace',
  theme: baseTheme,
  cursorBlink: true,
  cursorStyle: 'bar'
});

export function runFakeTerminal() {
  initializeXterm(); //åˆå§‹åŒ– Xterm
  if (term._initialized) {
    return;
  }
  term._initialized = true;
  term.writeln('Hello, Welcome To QCOM!ğŸŠ');
  customData(term);
}

function initializeXterm() {
  term.loadAddon(fitAddon);
  term.loadAddon(new WebLinksAddon());
  term.open(document.getElementById('xterm-inner'));
  setTimeout(() => {
    fitAddon.fit();
  }, 60);
  try {
    term.loadAddon(new WebglAddon());
  } catch (e) {
    console.warn('WebGL addon threw an exception during load', e);
  }
  document.querySelector('.xterm').addEventListener('wheel', handleWheel);
}

function handleWheel(e) {
  if (term.buffer.active.baseY > 0) {
    e.preventDefault();
  }
}
```

#### 2. åˆ›å»ºä¸»é¢˜æ–‡ä»¶ï¼Œ`theme.js`

```javascript
export const baseTheme = {
  foreground: '#F8F8F8',
  background: '#2D2E2C',
  selection: '#5DA5D533',
  black: '#1E1E1D',
  brightBlack: '#262625',
  red: '#CE5C5C',
  brightRed: '#FF7272',
  green: '#5BCC5B',
  brightGreen: '#72FF72',
  yellow: '#CCCC5B',
  brightYellow: '#FFFF72',
  blue: '#5D5DD3',
  brightBlue: '#7279FF',
  magenta: '#BC5ED1',
  brightMagenta: '#E572FF',
  cyan: '#5DA5D5',
  brightCyan: '#72F0FF',
  white: '#F8F8F8',
  brightWhite: '#FFFFFF'
};
// vscode-snazzy https://github.com/Tyriar/vscode-snazzy
export const otherTheme = {
  foreground: '#eff0eb',
  background: '#282a36',
  selection: '#97979b33',
  black: '#282a36',
  brightBlack: '#686868',
  red: '#ff5c57',
  brightRed: '#ff5c57',
  green: '#5af78e',
  brightGreen: '#5af78e',
  yellow: '#f3f99d',
  brightYellow: '#f3f99d',
  blue: '#57c7ff',
  brightBlue: '#57c7ff',
  magenta: '#ff6ac1',
  brightMagenta: '#ff6ac1',
  cyan: '#9aedfe',
  brightCyan: '#9aedfe',
  white: '#f1f1f0',
  brightWhite: '#eff0eb'
};
```

#### 3. åˆ›å»ºå¤„ç†æ•°æ®æ–‡ä»¶ï¼Œ`data.js`

```javascript
export function customData(term) {
  term.onData((e) => {
    sendData(e);
  });
}

async function sendData(e) {
  // å®šä¹‰è‡ªå·±çš„å¤„ç†é€»è¾‘
}
```

#### 4. åˆ›å»º Xterm ç»„ä»¶ MyXterm.vue

```vue
<script setup>
import { runFakeTerminal } from '@/utils/xterm/main';
import '@xterm/xterm/css/xterm.css';
import { fitAddon } from '@/utils/xterm/main';

const resizeHandler = () => {
  fitAddon.fit();
};
onMounted(() => {
  runFakeTerminal();
  window.addEventListener('resize', resizeHandler);
});
onUnmounted(() => {
  window.removeEventListener('resize', resizeHandler);
});
</script>
<template>
  <div id="xterm-body" class="rounded px-3 py-2 bg-[#2d2e2c] pr-1 h-full min-h-[300px]">
    <div id="xterm-inner" class="h-full"></div>
  </div>
</template>

<style>
.xterm-viewport::-webkit-scrollbar {
  width: 8px;
}
.xterm-viewport::-webkit-scrollbar-track {
  opacity: 0;
}
.xterm-viewport::-webkit-scrollbar-thumb {
  min-height: 20px;
  background-color: #a0a0a092;
}
</style>
```

## æ³¨æ„äº‹é¡¹

1. è¯·ä¸è¦åœ¨ `xterm-inner ` ä¸Šè®¾ç½® `padding` ç­‰å½±å“å¤§å°çš„æ ·å¼
1. å¦‚æœé‡åˆ°ç»ˆç«¯å¤§å°å’Œçˆ¶å…ƒç´ ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¯·åœ¨ `xterm.open` åå»¶è¿Ÿæ‰§è¡Œ `fitAddon.fit()`
1. æˆ‘ä¹‹æ‰€ä»¥å¯¼å‡º `fitAddon` æ–¹æ³•ï¼Œæ˜¯å› ä¸ºæˆ‘éœ€è¦å»ç›‘å¬å…¶ä»–ç»„ä»¶å¤§å°çš„å˜åŒ–ï¼Œç„¶åè®©ç»ˆç«¯å¤§å°è‡ªé€‚åº”ã€‚

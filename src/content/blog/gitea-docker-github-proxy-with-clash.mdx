---
publishDate: 2025-10-22
title: åœ¨ Docker Gitea ä¸­ä½¿ç”¨ Clash ä»£ç†è§£å†³ GitHub ä»“åº“è¿ç§»å¤±è´¥é—®é¢˜
excerpt: åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸­ï¼ŒGitea è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­æ—¶å¾€å¾€æ— æ³•ç›´æ¥ä» GitHub è¿ç§»ä»“åº“ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•é€šè¿‡é…ç½® Clash ä»£ç†ã€Docker ç½‘ç»œå’Œ Gitea çš„è¿ç§»ç­–ç•¥ï¼Œè®© Gitea æˆåŠŸèµ°ä»£ç†è®¿é—® GitHubï¼Œå®ç°ç¨³å®šçš„ä»£ç è¿ç§»ä¸åŒæ­¥ã€‚
image: '~/assets/images/blog/snowy-mountains-rise-from-the-ocean-at-sunrise-IHfbPJYsnsI.jpg'
category: ops
tags: [Gitea, Clash, Docker, GitHub]
metadata:
  image_author:
    link: https://unsplash.com/@supergios
    name: supergios
---

# åœ¨ Docker Gitea ä¸­ä½¿ç”¨ Clash ä»£ç†è§£å†³ GitHub ä»“åº“è¿ç§»å¤±è´¥é—®é¢˜

åœ¨å›½å†…ç½‘ç»œç¯å¢ƒä¸‹ï¼Œé€šè¿‡ Gitea è¿ç§» GitHub ä»“åº“æ—¶ï¼Œç»å¸¸ä¼šå› ä¸ºç½‘ç»œé™åˆ¶å¯¼è‡´å…‹éš†å¤±è´¥ã€‚å³ä¾¿å®¿ä¸»æœºå¯ä»¥æ­£å¸¸è®¿é—® GitHubï¼Œè¿è¡Œåœ¨ Docker å®¹å™¨ä¸­çš„ Gitea ä»å¯èƒ½æ— æ³•è¿æ¥åˆ°è¿œç¨‹ä»“åº“ã€‚

æœ¬æ–‡è®°å½•äº†æˆ‘åœ¨å®é™…æ“ä½œä¸­ï¼Œé€šè¿‡é…ç½® **Clash ä»£ç† + Docker ç¯å¢ƒå˜é‡ + Gitea è¿ç§»è®¾ç½®**ï¼ŒæˆåŠŸè§£å†³è¯¥é—®é¢˜çš„å®Œæ•´è¿‡ç¨‹ã€‚

---

## ä¸€ã€é—®é¢˜èƒŒæ™¯

Gitea æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è‡ªæ‰˜ç®¡ Git æœåŠ¡ï¼Œéå¸¸é€‚åˆå›¢é˜Ÿç§æœ‰éƒ¨ç½²ã€‚ç„¶è€Œï¼Œå½“ Gitea è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­æ—¶ï¼Œç›´æ¥ä» GitHub è¿ç§»ä»“åº“å¾€å¾€ä¼šå¤±è´¥ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š

```
migration failed: clone error: exit status 128 - fatal: unable to access 'https://github.com/Dacong-wu/astro-blog.git/': OpenSSL SSL_read: OpenSSL/3.5.4: error:0A000126:SSL routines::unexpected eof while reading, errno 0
```

åˆ†æåå‘ç°ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

1. å®¿ä¸»æœºå¯ä»¥è®¿é—® GitHubï¼Œä½†å®¹å™¨ç½‘ç»œä¸å®¿ä¸»æœºéš”ç¦»ï¼Œæ— æ³•å¤ç”¨å®¿ä¸»æœºçš„ä»£ç†ï¼›
2. Gitea é»˜è®¤ç¦æ­¢è¿ç§»ä»»åŠ¡è®¿é—®å†…ç½‘åœ°å€ï¼ˆå¦‚ `192.168.x.x`ï¼‰ï¼›
3. å³ä½¿åœ¨å®¹å™¨ä¸­é…ç½®äº† git ä»£ç†ï¼ŒGitea Web ç•Œé¢çš„è¿ç§»è¿›ç¨‹ä¹Ÿæœªç»§æ‰¿ç›¸åº”ç¯å¢ƒå˜é‡ã€‚

---

## äºŒã€é…ç½® Clash ä»£ç†

Clash æ˜¯ä¸€æ¬¾æµè¡Œçš„ä»£ç†å·¥å…·ï¼Œæ—¢æ”¯æŒè§„åˆ™åˆ†æµï¼Œä¹Ÿæ”¯æŒ LAN å±€åŸŸç½‘è®¿é—®ã€‚  
ç¼–è¾‘é…ç½®æ–‡ä»¶ `/opt/clash/config.yaml`ï¼š

```yaml
port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: 0.0.0.0:9090
unified-delay: true
```

ç¡®ä¿ `allow-lan: true`ï¼Œè¿™æ ·å±€åŸŸç½‘è®¾å¤‡ï¼ˆåŒ…æ‹¬ Docker å®¹å™¨ï¼‰å°±èƒ½è®¿é—®ä»£ç†ç«¯å£ã€‚

å¯åŠ¨ Clash åéªŒè¯ï¼š

```bash
ss -tulnp | grep 7890
```

è‹¥è¾“å‡ºå¦‚ä¸‹è¡¨ç¤ºä»£ç†ç›‘å¬æˆåŠŸï¼š

```
tcp   LISTEN 0      4096      *:7890     *:*    users:(("clash",pid=501046,fd=8))
```

---

## ä¸‰ã€è®© Gitea å®¹å™¨ä½¿ç”¨å®¿ä¸»æœºä»£ç†

Docker é»˜è®¤ä½¿ç”¨ç‹¬ç«‹ç½‘ç»œï¼ˆå¦‚ bridge æ¨¡å¼ï¼‰ï¼Œæ— æ³•ç›´æ¥è®¿é—®å®¿ä¸»æœºçš„ 127.0.0.1ã€‚  
æˆ‘ä»¬å¯ä»¥é€šè¿‡ `host.docker.internal` æˆ– `--add-host` è®©å®¹å™¨è®¿é—®å®¿ä¸»æœºã€‚

è¿è¡Œå®¹å™¨æ—¶æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
docker run -d \
  --name=gitea \
  -p 3000:3000 \
  -p 222:22 \
  -v /etc/gitea:/data \
  -e HTTP_PROXY=http://host.docker.internal:7890 \
  -e HTTPS_PROXY=http://host.docker.internal:7890 \
  -e GIT_HTTP_PROXY=http://host.docker.internal:7890 \
  --add-host=host.docker.internal:host-gateway \
  gitea/gitea:latest
```

éªŒè¯ä»£ç†æ˜¯å¦ç”Ÿæ•ˆï¼š

```bash
docker exec -it gitea bash
env | grep -i proxy
```

æ­£å¸¸æƒ…å†µä¸‹åº”è¾“å‡ºï¼š

```
HTTP_PROXY=http://host.docker.internal:7890
HTTPS_PROXY=http://host.docker.internal:7890
GIT_HTTP_PROXY=http://host.docker.internal:7890
```

---

## å››ã€ä¿®æ”¹ Gitea é…ç½®ä»¥å…è®¸è¿ç§»å†…ç½‘åœ°å€

ç¼–è¾‘ Gitea é…ç½®æ–‡ä»¶ `/data/gitea/conf/app.ini`ï¼Œåœ¨ `[migrations]` æ®µä¸­æ·»åŠ ï¼š

```ini
[migrations]
ALLOW_LOCALNETWORKS = true

[proxy]
PROXY_ENABLED = true
PROXY_URL = 
PROXY_HOSTS = *.github.com
```

è¿™ä¸€æ­¥éå¸¸å…³é”®ã€‚å› ä¸º Gitea å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé»˜è®¤ç¦æ­¢è®¿é—®å†…ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ 192.168.x.xï¼‰ï¼Œè€Œ Clash ä»£ç†æ­£å¥½æ˜¯é€šè¿‡å®¿ä¸»æœºå†…ç½‘è®¿é—®çš„ã€‚

ä¿®æ”¹å®Œæˆåé‡å¯ Giteaï¼š

```bash
docker restart gitea
```

---

## äº”ã€è®¾ç½® Git å…¨å±€ä»£ç†ï¼ˆå®¹å™¨å†…ï¼‰

æœ‰æ—¶ Gitea çš„è¿ç§»ä»»åŠ¡ä»ç„¶ä¸ä¼šç»§æ‰¿ç³»ç»Ÿä»£ç†é…ç½®ï¼Œæ­¤æ—¶éœ€è¦ä¸º Git å•ç‹¬è®¾ç½®ä»£ç†ã€‚

è¿›å…¥å®¹å™¨åæ‰§è¡Œï¼š

```bash
git config --global http.proxy http://host.docker.internal:7890
git config --global https.proxy http://host.docker.internal:7890
git config --global http.version HTTP/1.1
```

`HTTP/1.1` å¯ä»¥é¿å…éƒ¨åˆ† SSL æ¡æ‰‹å¼‚å¸¸é—®é¢˜ã€‚

éªŒè¯ä»£ç†æ˜¯å¦ç”Ÿæ•ˆï¼š

```bash
git ls-remote https://github.com/Dacong-wu/astro-blog.git
```

å¦‚æœèƒ½åˆ—å‡ºåˆ†æ”¯ä¸æ ‡ç­¾ï¼Œè¯´æ˜ä»£ç†å·²ç»ç”Ÿæ•ˆã€‚

---

## å…­ã€æµ‹è¯• Clash æ—¥å¿—ç¡®è®¤æµé‡èµ°ä»£ç†

æ­¤æ—¶ï¼ŒClash æ—¥å¿—åº”å‡ºç°ç±»ä¼¼è®°å½•ï¼š

```
[TCP] connected lAddr=172.18.0.8:41200 rAddr=github.com:443 mode=rule rule=DomainKeyword(github) proxy=ğŸ”° é€‰æ‹©èŠ‚ç‚¹[ğŸ‡­ğŸ‡° é¦™æ¸¯Y01]
```

è¯´æ˜ Docker å®¹å™¨çš„è®¿é—®è¯·æ±‚ç¡®å®é€šè¿‡ Clash è½¬å‘ã€‚

---

## ä¸ƒã€åœ¨ Gitea Web ç•Œé¢æµ‹è¯•è¿ç§»

ç°åœ¨å¯ä»¥è¿”å› Gitea ç•Œé¢å°è¯•è¿ç§»ï¼š

1. æ‰“å¼€ **Gitea â†’ New Migration**
2. å¡«å†™ GitHub ä»“åº“åœ°å€ï¼Œä¾‹å¦‚ `https://github.com/Dacong-wu/astro-blog.git`
3. ç‚¹å‡»å¼€å§‹è¿ç§»
4. è§‚å¯Ÿ Clash Dashboardï¼Œå¦‚æœå‡ºç° GitHub ç›¸å…³è¯·æ±‚ï¼Œå³è¡¨ç¤ºä»£ç†å·²ç”Ÿæ•ˆ

è¿ç§»æˆåŠŸåæ—¥å¿—ç¤ºä¾‹ï¼š

```
[TCP] connected lAddr=172.18.0.8:33420 rAddr=www.google.com:443 mode=rule rule=DomainKeyword(github) proxy=ğŸ”° é€‰æ‹©èŠ‚ç‚¹[ğŸ‡­ğŸ‡° é¦™æ¸¯Y01]
```

---

## å…«ã€æ€»ç»“

é—®é¢˜æ ¹æºåœ¨äºï¼š

- å®¹å™¨é»˜è®¤æ— æ³•è®¿é—®å®¿ä¸»æœºçš„ 127.0.0.1ï¼›
- Gitea é»˜è®¤ç¦æ­¢è¿ç§»ä»»åŠ¡è®¿é—®å†…ç½‘ï¼›
- Git è¿›ç¨‹æœªç»§æ‰¿å…¨å±€ä»£ç†ç¯å¢ƒã€‚

è§£å†³æ–¹æ¡ˆæ€»ç»“å¦‚ä¸‹ï¼š

| æ­¥éª¤ | æ“ä½œ                                                       | è¯´æ˜                     |
| ---- | ---------------------------------------------------------- | ------------------------ |
| 1    | Clash å¯ç”¨ `allow-lan: true`                               | å…è®¸å±€åŸŸç½‘è®¿é—®ä»£ç†ç«¯å£   |
| 2    | Docker æ·»åŠ  `--add-host=host.docker.internal:host-gateway` | è®©å®¹å™¨å¯è®¿é—®å®¿ä¸»æœº       |
| 3    | è®¾ç½® `HTTP_PROXY/HTTPS_PROXY/GIT_HTTP_PROXY` ç¯å¢ƒå˜é‡      | è®© Gitea å’Œ Git ä½¿ç”¨ä»£ç† |
| 4    | ä¿®æ”¹ Gitea `[migrations]` é…ç½®                             | å…è®¸è®¿é—®å†…ç½‘ IP          |
| 5    | éªŒè¯ Gitã€Clash æ—¥å¿—                                       | ç¡®è®¤è¿ç§»æµé‡èµ°ä»£ç†       |

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒGitea åœ¨ Docker ä¸­å³å¯é¡ºåˆ©é€šè¿‡ Clash ä»£ç†è®¿é—® GitHubï¼Œå®ç°ä»“åº“è¿ç§»å’ŒåŒæ­¥ã€‚

---

**å‚è€ƒå‘½ä»¤ï¼š**

```bash
# æŸ¥çœ‹ä»£ç†æ˜¯å¦ç›‘å¬
ss -tulnp | grep 7890

# æŸ¥çœ‹ Clash æ—¥å¿—
tail -f /opt/clash/clash.log

# æŸ¥çœ‹ Git å…¨å±€ä»£ç†é…ç½®
git config --global --list | grep proxy
```

é…ç½®å®Œæˆåï¼Œä½ çš„ Gitea å°†å…·å¤‡å®Œæ•´çš„ä»£ç†è®¿é—®èƒ½åŠ›ï¼Œæ— è®ºæ˜¯è¿ç§»ã€Webhookã€è¿˜æ˜¯è‡ªåŠ¨æ›´æ–°å­æ¨¡å—ï¼Œéƒ½èƒ½é¡ºåˆ©è¿æ¥åˆ° GitHubã€‚
